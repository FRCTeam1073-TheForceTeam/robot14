/* FIRST Team 1073's RobotBuilder (0.0.2) for WPILibExtensions ---
Do not mix this code with any other version of RobotBuilder! */
#include "Launcher.h"
#include "../Robotmap.h"
#include "../Robot.h"
const int pressureLimitDflt = 60;
int Launcher::pressureLimit = 0;
#define PSI_CONSTANT (22.22222)
Launcher::Launcher() : Subsystem("Launcher") {
	// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DECLARATIONS
	compressor = RobotMap::launcherCompressor;
	solenoidLeft = RobotMap::launcherSolenoidLeft;
	solenoidRight = RobotMap::launcherSolenoidRight;
    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DECLARATIONS
	compressor->Start();
	pressureTransducer = RobotMap::launcherPressureSwitch;
	pressureLimit = Robot::prefs->GetInt("LauncherPressureLimit", pressureLimitDflt);
	willCompress=2;
	isCompressorReady=false;
	isLaucherReady=false;
}
    
void Launcher::InitDefaultCommand() {
	// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DEFAULT_COMMAND
    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DEFAULT_COMMAND
}
void Launcher::OpenTank() {
	solenoidLeft->Set(true);
	solenoidRight->Set(true);
}
void Launcher::CloseTank() {
	solenoidLeft->Set(false);
	solenoidRight->Set(false);
}
//TODO: Constant may need to be calibrated
bool Launcher::IsBadPressure() {
	float PSI = pressureTransducer->GetPressurePSI();
	if (PSI <= pressureLimit){
		return true;
	}		
	else 
		return false;
}
bool Launcher::AreTanksOpen() {
	return solenoidLeft->Get() && solenoidRight->Get();
}
//BEGIN DEBUG CODE
/*void Launcher::Launch(){
	solenoidLeft->Set(true);
	solenoidRight->Set(true);
	Wait(1.5);
	solenoidLeft->Set(false);
	solenoidRight->Set(false);
}*/
//END DEBUG CODE
void Launcher::Compress() {
	if(willCompress%2==0){
		compressor->Start();
	}
	else{
		compressor->Stop();
	}
	willCompress++;
	if(willCompress==1000){
		willCompress=2;
	}
}
void Launcher::canCompress(){
	if(compressor->Enabled())isCompressorReady=true;
	else
		isCompressorReady=false;
}
void Launcher::autoStopLauch(){
	if(solenoidLeft->Get()&&solenoidRight->Get())
		isLaucherReady=true;
	solenoidLeft->Set(false);
	solenoidRight->Set(false);
}
bool Launcher::isTransducerReady(){
	float thePSI = pressureTransducer->GetVoltage()*PSI_CONSTANT;
	return ((0<thePSI)&&(thePSI<130));
}
